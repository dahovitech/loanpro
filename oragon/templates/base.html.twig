<!DOCTYPE html>
<html lang="{{ app.request.locale }}">
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Oragon{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text></svg>">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        {% block stylesheets %}
            {# Bootstrap CSS #}
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
            {# Bootstrap Icons #}
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
            <style>
                :root {
                    --bs-primary: #0d6efd;
                    --bs-secondary: #6c757d;
                    --bs-success: #198754;
                    --bs-info: #0dcaf0;
                    --bs-warning: #ffc107;
                    --bs-danger: #dc3545;
                    --bs-light: #f8f9fa;
                    --bs-dark: #212529;
                }
                
                [data-bs-theme="dark"] {
                    --bs-body-bg: #1a1a1a;
                    --bs-body-color: #ffffff;
                    --bs-border-color: #333333;
                }

                .navbar-brand {
                    font-weight: bold;
                    font-size: 1.5rem;
                }

                .language-selector {
                    background: transparent;
                    border: 1px solid var(--bs-border-color);
                    color: var(--bs-body-color);
                }

                .language-selector:focus {
                    border-color: var(--bs-primary);
                    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
                }

                .service-card {
                    transition: transform 0.2s ease-in-out;
                    border: 1px solid var(--bs-border-color);
                }

                .service-card:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                }

                [data-bs-theme="dark"] .service-card:hover {
                    box-shadow: 0 4px 8px rgba(255,255,255,0.1);
                }

                .theme-toggle {
                    cursor: pointer;
                    transition: transform 0.2s ease-in-out;
                }

                .theme-toggle:hover {
                    transform: scale(1.1);
                }

                .footer {
                    background-color: var(--bs-light);
                    border-top: 1px solid var(--bs-border-color);
                }

                [data-bs-theme="dark"] .footer {
                    background-color: var(--bs-dark);
                }
            </style>
        {% endblock %}

        {% block javascripts %}
            {# Bootstrap JS with Popper.js #}
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
            {# Axios for API calls #}
            <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
        {% endblock %}
    </head>

    <body>
        {% block header %}
            {% include '_header.html.twig' %}
        {% endblock %}

        <main class="flex-shrink-0">
            {% block body %}{% endblock %}
        </main>

        {% block footer %}
            <footer class="footer mt-auto py-3">
                <div class="container">
                    <div class="d-flex flex-column flex-sm-row justify-content-between py-4 border-top">
                        <p class="text-muted mb-1 mb-sm-0">© {{ 'now'|date('Y') }} Oragon. Tous droits réservés.</p>
                        <p class="text-muted mb-0">
                            Développé par <strong>MiniMax Agent</strong>
                        </p>
                    </div>
                </div>
            </footer>
        {% endblock %}

        {% block extra_javascripts %}
            <script>
                // Theme management
                const getStoredTheme = () => localStorage.getItem('theme')
                const setStoredTheme = theme => localStorage.setItem('theme', theme)

                const getPreferredTheme = () => {
                    const storedTheme = getStoredTheme()
                    if (storedTheme) {
                        return storedTheme
                    }
                    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
                }

                const setTheme = theme => {
                    document.documentElement.setAttribute('data-bs-theme', theme)
                    
                    // Update theme toggle icon
                    const themeToggle = document.querySelector('#themeToggle')
                    if (themeToggle) {
                        const icon = themeToggle.querySelector('i')
                        if (theme === 'dark') {
                            icon.className = 'bi bi-sun-fill'
                        } else {
                            icon.className = 'bi bi-moon-fill'
                        }
                    }
                }

                // Initialize theme
                setTheme(getPreferredTheme())

                // Theme toggle handler
                window.addEventListener('DOMContentLoaded', () => {
                    const themeToggle = document.querySelector('#themeToggle')
                    if (themeToggle) {
                        themeToggle.addEventListener('click', () => {
                            const currentTheme = document.documentElement.getAttribute('data-bs-theme')
                            const newTheme = currentTheme === 'dark' ? 'light' : 'dark'
                            setStoredTheme(newTheme)
                            setTheme(newTheme)
                        })
                    }
                })

                // Language switching functionality
                function switchLanguage(languageCode) {
                    axios.post(`/api/switch-language/${languageCode}`)
                        .then(response => {
                            if (response.data.success) {
                                // Reload the page to apply the new language
                                window.location.reload()
                            }
                        })
                        .catch(error => {
                            console.error('Erreur lors du changement de langue:', error)
                        })
                }

                // Auto-hide alerts after 5 seconds
                document.addEventListener('DOMContentLoaded', function() {
                    const alerts = document.querySelectorAll('.alert:not(.alert-permanent)')
                    alerts.forEach(function(alert) {
                        setTimeout(function() {
                            const bsAlert = new bootstrap.Alert(alert)
                            bsAlert.close()
                        }, 5000)
                    })
                })
            </script>
        {% endblock %}
    </body>
</html>
